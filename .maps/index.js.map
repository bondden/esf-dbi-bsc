{"version":3,"sources":["index.es7.js"],"names":[],"mappings":"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","file":"index.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 14.08.2015.\n */\n\"use strict\";\n\nif(!ESF_UNHDLD_RJ_INTRCPTR || typeof ESF_UNHDLD_RJ_INTRCPTR === 'undefined'){\n  process.on('unhandledRejection', function(reason, p) {\n\n    if(reason.message.match(/Error on parsing command at position #0: Class '[^'\\\\]+' was not found/ig)){\n      console.log('Warning: Conjecture of class absence. Reason: '+reason.message.replace('Error on parsing command at position #0: ',''));\n    }else{\n      console.log('\\nUnhandled Rejection at: Promise \\n', p, ' \\nreason: ', reason,'\\n');\n      console.trace(p);\n    }\n\n  });\n  var ESF_UNHDLD_RJ_INTRCPTR=true;\n}\n\nvar\n  path     =require('path'),\n  fs       =require('fs-extra'),\n  ojs      =require('orientjs')\n;\n\nimport * as modUtl from '@bond007/esf-utl';\n\nvar\n  Utl=modUtl.Utl,\n  L  =Utl.log,\n  E  =Utl.rejectingError\n;\n\nexport class DBIBsc {\n\n  constructor(){\n    this.db =null;\n    this.cfg=null;\n    this.connAttempts=0;\n  }\n\n\n  init(cfg){\n    var H=this;\n\n    var _initDbConnection=function(){\n      return new Promise((rs,rj)=>{\n        try{\n\n          L('Initializing OrientDB client...');\n\n          var odbSrv=ojs(H.cfg.modes[H.cfg.mode].acc.odb.srv);\n          H.db      =odbSrv.use(H.cfg.modes[H.cfg.mode].acc.odb.usr);\n\n          H.db.on(\"error\",function(e){\n            return E(1012,'Error communicating with OrientDB',e,rj);\n          });\n\n          L('OrientDB client initialized');\n\n          rs(H.db);\n\n        }catch(e1){\n\n          H.connAttempts++;\n\n          L('Unsuccessful initialization of OrientDB client. ' +\n            'Retrying attempt '+H.connAttempts+' of '+H.cfg.modes[H.cfg.mode].pcs.dbConnRetries+'...');\n\n          if(H.connAttempts<H.cfg.modes[H.cfg.mode].pcs.dbConnRetries){\n            setTimeout(()=>{\n              _initDbConnection().then((rr)=>{\n                rs(rr);\n              }).catch((ee)=>{\n                E(1011,'Error initializing OrientDB client',ee,rj);\n              });\n            },H.cfg.modes[H.cfg.mode].pcs.dbConnTmOut);\n          }else{\n            return E(1013,'All '+H.cfg.modes[H.cfg.mode].pcs.dbConnRetries+' connection attempts exceeded while initializing OrientDB client',e1,rj);\n          }\n\n        }\n      });\n    };\n\n    return new Promise((rs,rj)=>{\n\n      //initializing config\n      H.cfg=cfg;\n\n      //initializing db connection\n      _initDbConnection().then((odb)=>{\n        rs(H.db);\n      }).catch((e)=>{\n        E(1,'Error initializing connection to OrientDB',e,rj);\n      });\n\n    });\n  }\n  //todo: cache-independent class existence checking\n  classExists(clsName){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n      H.db.class.list().then((clsList)=>{\n\n        let r=clsList.find((v,i,a)=>{\n          return v.name&&v.name===clsName;\n        })?true:false;\n\n        rs(r);\n\n      }).catch((e)=>{\n        E(41,'db error',e,rj);\n      });\n\n    });\n  }\n\n  createClassIfNotExists(classData){\n    var H=this;\n    return new Promise((rsc,rjc)=>{\n\n      H.classExists(classData.name).then((r)=>{\n\n        if(r){\n\n          H.db.class.get(classData.name).then((r2)=>{\n            rsc(r2);\n          }).catch((e2)=>{\n            return E(54,'db error',e2,rjc);\n          });\n\n        }else{\n\n          H.createClass(classData).then((r3)=>{\n            rsc(r3);\n          }).catch((e3)=>{\n            return E(53,'db error',e3,rjc);\n          });\n\n        }\n\n      }).catch((e)=>{\n        return E(52,'db error',e,rjc);\n      });\n\n    });\n  }\n\n  createClass(classData){\n    var H=this;\n\n    var _createClassProperty =function(clsPtr,propData){\n      var H=this;\n      return new Promise((rs,rj)=>{\n\n        clsPtr.property.create(propData).then((r)=>{\n          rs(r);\n        }).catch((e)=>{\n          E(51,'Error creating property '+propData.name+' for '+clsPtr.name,e,rj);\n        });\n\n      });\n    };\n\n    return new Promise((rs,rj)=>{\n\n      L('Creating class '+classData.name+'...');\n\n      H.db.class.create(classData.name,'V').then((clsDbPtr)=>{\n\n        if(!clsDbPtr.name||clsDbPtr.name!==classData.name){\n          let msg='Error creating class '+classData.name;\n          return E(43,msg,new Error(msg),rj);\n        }\n\n        let wtr=[];\n        classData.props.forEach((propData,i,a)=>{\n          wtr.push(_createClassProperty(clsDbPtr,propData));\n          if(i===a.length-1){\n            Promise.all(wtr).then((rw)=>{\n\n              L('Class '+classData.name+' created successfully');\n\n              rs(clsDbPtr);\n            }).catch((ew)=>{\n              return E(44,'Error adding props to class '+classData.name,ew,rj);\n            });\n          }\n        });\n\n      }).catch((e)=>{\n        \n        if(e.message.indexOf('already exists in current database')!==-1){\n          H.db.class.get(classData.name).then((r2)=>{\n            rs(r2);\n          }).catch((e2)=>{\n            return E(45,'db error',e2,rj);\n          });\n        }else{          \n          return E(42,'Error creating class '+classData.name,e,rj);          \n        }\n        \n      });\n\n    });\n  }\n\n  insertRecords(records){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  restoreClass(archiveId){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  archiveClass(className,transactionId='',pth=''){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n      let data={\n        \"class\"  :{\n          \"name\"            :null,\n          \"shortName\"       :null,\n          \"defaultClusterId\":null,\n          \"clusterIds\"      :null,\n          \"superClass\"      :null,\n          \"originalName\"    :null\n        },\n        \"records\":[]\n      };\n\n      let dftProp={\n        \"name\"        :null,\n        \"originalName\":null,\n        \"type\"        :null,\n        \"mandatory\"   :null,\n        \"readonly\"    :null,\n        \"notNull\"     :null,\n        \"collate\"     :null,\n        \"min\"         :null,\n        \"max\"         :null,\n        \"regexp\"      :null,\n        \"linkedClass\" :null\n      };\n\n      H.db.class.get(className).then((r)=>{\n\n        try{\n\n          //process properties\n          Object.keys(data.class).forEach((k)=>{\n            data.class[k]=r[k];\n          });\n\n          data.class['properties']=[];\n\n          r.properties.forEach((rpro)=>{\n\n            let newProp=JSON.parse(JSON.stringify(dftProp));\n\n            Object.keys(dftProp).forEach((pf)=>{\n              newProp[pf]=rpro[pf];\n            });\n\n            data.class.properties.push(newProp);\n\n          });\n\n          //process records\n          H.db.select()\n            .from(className)\n            .all()\n            .then((recs)=>{\n\n            recs.forEach((rr)=>{\n\n              if(rr.parent && rr.parent['@class']===rr['@class']){\n                rr.parent=rr['@class'];\n              }\n\n              data.records.push(JSON.parse(JSON.stringify(rr,null,'\\t')));\n            });\n\n            //save to history\n            //todo: use db to store class versions\n            //todo: support large amount of records with Jl-writer\n\n            let filePath=path.resolve(pth+'/'+transactionId+'_'+className+'.json');\n\n            L('Saving archive to '+filePath+' for class '+className+'...');\n\n            fs.writeJSON(filePath,data,(ew)=>{\n\n              if(ew){\n                E(506,'Error saving archive to '+filePath+' for class '+className,ew,rj);\n              }\n\n              L('Saved archive for class '+className+'');\n              rs(className);\n\n            });\n\n            }).catch((e4)=>{\n              E(505,'Error getting records for class '+className,e4,rj);\n            });\n\n        }catch(e1){\n          E(504,'Error extracting properties of class '+className,e1,rj);\n        }\n\n      }).catch((e)=>{\n\n        if(e.message.indexOf('No such class:')!==-1){\n          L('Warning: no such class '+className,'y');\n          rs('No such class: '+className);\n        }else{\n          E(503,'Error getting class '+className,e,rj);\n        }\n      });\n\n    });\n  }\n\n  dropClass(vtxName){\n    var H=this;\n    return Promise.race([\n      new Promise((rs,rj)=>{\n        let tmOut=H.cfg.modes[H.cfg.mode].pcs.clsDelTmOut;\n        setTimeout(()=>{\n          rs('Warning: class deletion timeout of '+tmOut+' exceeded','em');\n        },tmOut);\n      }),\n      new Promise((rs,rj)=>{\n\n        let q='delete vertex '+vtxName;\n\n        try{\n          H.db.exec(q).then((r)=>{\n\n            if(!r|| !r.hasOwnProperty('results')){\n              return E(523,'q: '+q,new Error('q: '+q),rj);\n            }\n\n            H.db.exec('drop class '+vtxName).then((r1)=>{\n\n              rs(r1);\n\n            }).catch((e1)=>{\n              E(522,'Error dropping '+vtxName,e1,rj);\n            });\n\n          });\n        }catch(e){\n          E(521,'q: '+q,e,rj);\n        }\n\n      })\n    ]);\n  }\n\n  truncateClass(name){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  archiveClasses(classNames){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  dropClasses(classNames){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  createClasses(data){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n}\n"],"sourceRoot":"/source/"}