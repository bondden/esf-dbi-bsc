{"version":3,"sources":["index.es7.js"],"names":[],"mappings":"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","file":"index.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 14.08.2015.\n */\n\"use strict\";\n\nif(!ESF_UNHDLD_RJ_INTRCPTR||typeof ESF_UNHDLD_RJ_INTRCPTR==='undefined'){\n  process.on('unhandledRejection',function(reason,p){\n\n    if(reason.message.match(/Error on parsing command at position #0: Class '[^'\\\\]+' was not found/ig)){\n      console.log('Warning: Conjecture of class absence. Reason: '+reason.message.replace('Error on parsing command at position #0: ',''));\n    }else{\n      console.log('\\nUnhandled Rejection at: Promise \\n',p,' \\nreason: ',reason,'\\n');\n      console.trace(p);\n    }\n\n  });\n  var ESF_UNHDLD_RJ_INTRCPTR=true;\n}\n\nvar\n  path=require('path'),\n  fs  =require('fs-extra'),\n  ojs =require('orientjs')\n  ;\n\nimport * as modUtl from 'esf-utl';\n\nvar\n  Utl=modUtl.Utl,\n  L  =Utl.log,\n  E  =Utl.rejectingError\n  ;\n\nexport class DBIBsc {\n\n  constructor(){\n    this.db          =null;\n    this.cfg         =null;\n    this.connAttempts=0;\n  }\n\n  init(cfg){\n    var H=this;\n\n    var _initDbConnection=function(){\n      return new Promise((rs,rj)=>{\n        try{\n\n          L('Initializing OrientDB client...');\n\n          var odbSrv=ojs(H.cfg.modes[H.cfg.mode].acc.odb.srv);\n          H.db      =odbSrv.use(H.cfg.modes[H.cfg.mode].acc.odb.usr);\n\n          H.db.on(\"error\",function(e){\n            return E(1012,'Error communicating with OrientDB',e,rj);\n          });\n\n          L('OrientDB client initialized');\n\n          rs(H.db);\n\n        }catch(e1){\n\n          H.connAttempts++;\n\n          L('Unsuccessful initialization of OrientDB client. '+\n            'Retrying attempt '+H.connAttempts+' of '+H.cfg.modes[H.cfg.mode].pcs.dbConnRetries+'...');\n\n          if(H.connAttempts<H.cfg.modes[H.cfg.mode].pcs.dbConnRetries){\n            setTimeout(()=>{\n              _initDbConnection().then((rr)=>{\n                rs(rr);\n              }).catch((ee)=>{\n                E(1011,'Error initializing OrientDB client',ee,rj);\n              });\n            },H.cfg.modes[H.cfg.mode].pcs.dbConnTmOut);\n          }else{\n            return E(1013,'All '+H.cfg.modes[H.cfg.mode].pcs.dbConnRetries+' connection attempts exceeded while initializing OrientDB client',e1,rj);\n          }\n\n        }\n      });\n    };\n\n    return new Promise((rs,rj)=>{\n\n      //initializing config\n      H.cfg=cfg;\n\n      //initializing db connection\n      _initDbConnection().then((odb)=>{\n        rs(H.db);\n      }).catch((e)=>{\n        E(1,'Error initializing connection to OrientDB',e,rj);\n      });\n\n    });\n  }\n\n  //todo: cache-independent class existence checking\n  classExists(clsName){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n      H.db.class.list().then((clsList)=>{\n\n        let r=clsList.find((v,i,a)=>{\n          return v.name&&v.name===clsName;\n        })?true:false;\n\n        rs(r);\n\n      }).catch((e)=>{\n        E(41,'db error',e,rj);\n      });\n\n    });\n  }\n\n  createClassIfNotExists(classData){\n    var H=this;\n    return new Promise((rsc,rjc)=>{\n\n      H.classExists(classData.name).then((r)=>{\n\n        if(r){\n\n          H.db.class.get(classData.name).then((r2)=>{\n            rsc(r2);\n          }).catch((e2)=>{\n            return E(54,'db error',e2,rjc);\n          });\n\n        }else{\n\n          H.createClass(classData).then((r3)=>{\n            rsc(r3);\n          }).catch((e3)=>{\n            return E(53,'db error',e3,rjc);\n          });\n\n        }\n\n      }).catch((e)=>{\n        return E(52,'db error',e,rjc);\n      });\n\n    });\n  }\n\n  createClass(classData){\n    var H=this;\n\n    var _createClassProperty=function(clsPtr,propData){\n      var H=this;\n      return new Promise((rs,rj)=>{\n\n        clsPtr.property.create(propData).then((r)=>{\n          rs(r);\n        }).catch((e)=>{\n          E(51,'Error creating property '+propData.name+' for '+clsPtr.name,e,rj);\n        });\n\n      });\n    };\n\n    return new Promise((rs,rj)=>{\n\n      L('Creating class '+classData.name+'...');\n\n      H.db.class.create(classData.name,'V').then((clsDbPtr)=>{\n\n        if(!clsDbPtr.name||clsDbPtr.name!==classData.name){\n          let msg='Error creating class '+classData.name;\n          return E(43,msg,new Error(msg),rj);\n        }\n\n        let wtr=[];\n        classData.props.forEach((propData,i,a)=>{\n          wtr.push(_createClassProperty(clsDbPtr,propData));\n          if(i===a.length-1){\n            Promise.all(wtr).then((rw)=>{\n\n              L('Class '+classData.name+' created successfully');\n\n              rs(clsDbPtr);\n            }).catch((ew)=>{\n              return E(44,'Error adding props to class '+classData.name,ew,rj);\n            });\n          }\n        });\n\n      }).catch((e)=>{\n\n        if(e.message.indexOf('already exists in current database')!== -1){\n          H.db.class.get(classData.name).then((r2)=>{\n            rs(r2);\n          }).catch((e2)=>{\n            return E(45,'db error',e2,rj);\n          });\n        }else{\n          return E(42,'Error creating class '+classData.name,e,rj);\n        }\n\n      });\n\n    });\n  }\n\n  insertRecords(records){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  restoreClass(archiveId){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  archiveClass(className,transactionId='',pth=''){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n      let data={\n        \"class\":  {\n          \"name\":            null,\n          \"shortName\":       null,\n          \"defaultClusterId\":null,\n          \"clusterIds\":      null,\n          \"superClass\":      null,\n          \"originalName\":    null\n        },\n        \"records\":[]\n      };\n\n      let dftProp={\n        \"name\":        null,\n        \"originalName\":null,\n        \"type\":        null,\n        \"mandatory\":   null,\n        \"readonly\":    null,\n        \"notNull\":     null,\n        \"collate\":     null,\n        \"min\":         null,\n        \"max\":         null,\n        \"regexp\":      null,\n        \"linkedClass\": null\n      };\n\n      H.db.class.get(className).then((r)=>{\n\n        try{\n\n          //process properties\n          Object.keys(data.class).forEach((k)=>{\n            data.class[k]=r[k];\n          });\n\n          data.class['properties']=[];\n\n          r.properties.forEach((rpro)=>{\n\n            let newProp=JSON.parse(JSON.stringify(dftProp));\n\n            Object.keys(dftProp).forEach((pf)=>{\n              newProp[pf]=rpro[pf];\n            });\n\n            data.class.properties.push(newProp);\n\n          });\n\n          //process records\n          H.db\n           .select()\n           .from(className)\n           .all()\n           .then((recs)=>{\n\n             recs.forEach((rr)=>{\n\n               if(rr.parent&&rr.parent['@class']===rr['@class']){\n                 rr.parent=rr['@class'];\n               }\n\n               data.records.push(JSON.parse(JSON.stringify(rr,null,'\\t')));\n             });\n\n             //save to history\n             //todo: use db to store class versions\n             //todo: support large amount of records with Jl-writer\n\n             let filePath=path.resolve(pth+'/'+transactionId+'_'+className+'.json');\n\n             L('Saving archive to '+filePath+' for class '+className+'...');\n\n             fs.writeJSON(filePath,data,(ew)=>{\n\n               if(ew){\n                 E(506,'Error saving archive to '+filePath+' for class '+className,ew,rj);\n               }\n\n               L('Saved archive for class '+className+'');\n               rs(className);\n\n             });\n\n           }).catch((e4)=>{\n             E(505,'Error getting records for class '+className,e4,rj);\n           });\n\n        }catch(e1){\n          E(504,'Error extracting properties of class '+className,e1,rj);\n        }\n\n      }).catch((e)=>{\n\n        if(e.message.indexOf('No such class:')!== -1){\n          L('Warning: no such class '+className,'y');\n          rs('No such class: '+className);\n        }else{\n          E(503,'Error getting class '+className,e,rj);\n        }\n      });\n\n    });\n  }\n\n  dropClass(vtxName){\n    var H=this;\n    return Promise\n      .race([\n        new Promise((rs,rj)=>{\n          let tmOut=H.cfg.modes[H.cfg.mode].pcs.clsDelTmOut;\n          setTimeout(()=>{\n            rs('Warning: class deletion timeout of '+tmOut+' exceeded','em');\n          },tmOut);\n        }),\n        new Promise((rs,rj)=>{\n\n          let q='delete vertex '+vtxName;\n\n          try{\n            H.db.exec(q).then((r)=>{\n\n              if(!r|| !r.hasOwnProperty('results')){\n                return E(523,'q: '+q,new Error('q: '+q),rj);\n              }\n\n              H.db.exec('drop class '+vtxName).then((r1)=>{\n\n                rs(r1);\n\n              }).catch((e1)=>{\n                E(522,'Error dropping '+vtxName,e1,rj);\n              });\n\n            });\n          }catch(e){\n            E(521,'q: '+q,e,rj);\n          }\n\n        })\n      ]);\n  }\n\n  truncateClass(name){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  archiveClasses(classNames){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  dropClasses(classNames){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n  createClasses(data){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n    });\n  }\n\n}\n"],"sourceRoot":"/source/"}